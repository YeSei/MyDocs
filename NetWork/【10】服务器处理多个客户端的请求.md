# 【10】服务器监听多个客户端的请求
## 监听方式：
1. 服务器创建一个监听进程监听特定的端口。每次从此端口接收到连接请求，就新**建一个线程**来处理来自这个连接的消息，主进程继续监听端口。
2. 当然也可以**fork出子进程**进行监听处理。形式上多个进程共享（监听）一个端口，实则挂羊头卖狗肉。产生惊群现象，即一个连接会启动大量进程，消耗服务器资源。
    - 惊群效应的解决：nginx采用各进程轮流监听的方式。Linux分别采用accept和epoll_wait两种方式解决。
3. Linux kernel 3.9带来了**SO_REUSEPORT**特性。通过**SO_REUSEPORT**参数**可以使用（同一个或不同进程）多个socket绑定到同一个端口**。针对各个socket进行处理[https://www.cnblogs.com/anker/p/7076537.html](https://www.cnblogs.com/anker/p/7076537.html)（这里跟SO_REUSEADDR区别开，后者是端口复用，一般用于服务器重启，取消端口处于TIME_WAIT，直接使用该端口。）

## 10.1 为什么一个客户端不能通过同一个端口向多个服务器发送消息。而服务器却可以通过一个端口接受来自不同客户端的请求？
- 首先要知道<u>**端口port是不可抢占资源，同一时间只能被一个进程使用！**</u>
- 客户端的发送进程占用一个端口时，其他发送进程不能抢占此端口。
- 服务端可以使用一个监听进程监听某一个端口号，同样此端口就不能被服务器的发送/监听进程再次抢占。
- 服务器监听进程某一个端口，收到来自不同客户端消息，进程内部通过自己的方式辨别处理这些消息。